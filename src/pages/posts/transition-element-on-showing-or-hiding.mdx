---
layout: ../../layouts/BlogLayout.astro
title: 给元素显示与隐藏时增加过度动画效果
pubDate: 2022-11-02
tags: ["frontend", "css", "js"]
language: zh
---

import StackBlitz from "@components/StackBlitz.astro"

首先我们来看看这个从 [Headless UI](https://headlessui.com/react/dialog) 网站上搬过来的例子，这是一个简单的模态对话框。在开关对话框时，我们可以看到其背后的遮罩以及对话框本体都有一个过渡的动画效果，本篇文章将尝试使用不同的方式来实现该效果。

<div class="overflow-hidden rounded-md bg-gradient-to-r from-sky-400 to-indigo-500">
  <div class="w-full h-[322px]">
    <iframe src="https://headlessui.com/examples/react-dialog-hero" class="w-full h-full"></iframe>
  </div>
</div>

下面是一个简化版的例子，点击按钮切换下方的卡片的显隐状态，接下来我们要给卡片显示和隐藏时加上过渡的动画效果。

<StackBlitz project="web-platform-qo6dym" file="index.html" height="322" />

## Pure-CSS Approach

CSS 中的 [transition](https://developer.mozilla.org/en-US/docs/Web/CSS/transition) 属性正是用来实现我们想要的效果的，它可以让元素在不同状态之间切换时加上过渡效果。但在上述的例子当中，我们是通过给卡片设置 `display: none;` 的属性来隐藏该元素，而 `transition` 不会对 `display` 属性的切换增加过渡效果。

这时候很多人都会用 `opacity: 0` 代替 `display: none` 来隐藏元素的这样一个 trick，从下面的实例中我们可以看到的确实现了过渡的效果。

<StackBlitz project="web-platform-kesq9e" file="index.html" height="322" withConsole />

但这样的实现方式会有很多的问题，其中最主要的一个就是设置为 `opacity: 0` 的元素只是视觉上被隐藏了，但其实际仍然存在于文档流中，也就是说其仍然会占据布局空间并且产生用户交互事件，例如你可以尝试在上面的实例中点击隐藏后的卡片区域，控制台中可以看到有相应的点击事件的日志输出。另外有些地方会建议使用 [visibility](https://developer.mozilla.org/en-US/docs/Web/CSS/visibility) 属性来隐藏元素，通过该属性被隐藏的元素不会被渲染绘制出来，也无法产生点击事件，但其仍然会占据空间影响布局。因此通过更改 `opacity` 属性来隐藏元素的方法最终会导致更多 tricky 的问题。

## Wait for Transition

既然 transition 无法在 `display` 属性值发生变化时产生，那么我们只需要先修改 `opacity` 或其它将引起 transition 的属性，等待 transition 完成后再设置 `display` 属性就能达到我们想要的效果。

```js
const nextFrame = (callback) => requestAnimationFrame(() => requestAnimationFrame(callback))

trigger.addEventListener("click", () => {
  if (card.classList.contains("hidden")) {
    card.classList.remove("hidden")
    nextFrame(() => card.classList.add("opacity-100"))
  } else {
    card.classList.remove("opacity-100")
    card.classList.add("opacity-0")
    card.addEventListener("transitionend", function handler() {
      card.classList.add("hidden")
      card.removeEventListener("transitionend", handler)
    })
  }
})
```

具体效果就像下面的例子一样：

<StackBlitz project="web-platform-qcd2h1" file="index.html" height="322" />

> TO BE CONTINUED