---
import { css } from "styled-system/css"
import { Box, Flex } from "styled-system/jsx"
import MainLayout from "~/layouts/main-layout.astro"
import { PostList } from "~/components/layout/post-list"
import { Posts } from "~/libs/collections"
import { omit } from "radash"

export interface Props {
  title: string
  isArticleView?: boolean
}

const { title, isArticleView } = Astro.props

const posts = await Posts.paginated()
const initialPosts = posts[0].map((post) => omit(post, ["body"]))
---

<MainLayout title={title}>
  <Flex
    w="full"
    bgImage="radial-gradient(token(colors.bg.emphasized) 1px, transparent 0)"
    bgSize="20px 20px"
    bgPosition="-19px -19px"
    data-article-view={isArticleView || undefined}
  >
    <Box
      className={css({
        w: "full",
        "[data-article-view] &": {
          display: "none",
          w: "auto",
          lg: {
            display: "flex"
          }
        }
      })}
    >
      <PostList
        initialRoute={Astro.url.pathname}
        initialPosts={initialPosts}
        client:load
        transition:persist
      />
    </Box>

    <slot />
  </Flex>
</MainLayout>
